# Bugfix Plan: `decision-gap-check` vs Generated Audit Artifacts (v0)

## Problem

Running `audit` mutates `.cortex/manifest_v0.json` and `.cortex/reports/lifecycle_audit_v0.json`.
If `decision-gap-check` is executed afterward in the same working tree, it can fail on
`.cortex/manifest_v0.json` even when no user-level governance decision was introduced.

## Goal

Keep governance completeness enforcement strict for human-authored changes while avoiding false
failures caused by machine-generated audit bookkeeping.

## Proposed Solution

1. Add generated-artifact awareness to `decision-gap-check`.
2. Treat these as generated by default:
   - `.cortex/reports/lifecycle_audit_v0.json`
   - `.cortex/manifest_v0.json` when only audit-managed fields changed (for example `updated_at`,
     `phases.lifecycle_audited`).
3. Add explicit override flag:
   - `--strict-generated` to include generated artifacts in gap enforcement when needed.

## Implementation Outline

1. In `cortex_coach/coach.py`, introduce helper:
   - `is_generated_audit_delta(project_dir, rel_path) -> bool`
2. For manifest path:
   - compare against `HEAD` version when available
   - allow only known audit-managed field deltas
3. Exclude generated deltas from `governance_impact_files` unless `--strict-generated`.
4. Emit report metadata:
   - `generated_ignored_files`
   - `strict_generated`

## Test Plan

1. New test: run `audit` then `decision-gap-check` on clean repo -> pass.
2. New test: mutate non-generated manifest field (`project_name`) -> fail unless linked decision.
3. New test: `--strict-generated` after `audit` -> fail on manifest unless linked decision.

## Rollout

1. Implement in `cortex-coach`.
2. Validate in `cortex` using `quality-gate-ci`.
3. Update docs for `decision-gap-check` semantics and strict mode.
